<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Create stunning AI-generated wallpapers with Wallpaper Studio Pro. Choose from various genres and artistic styles.">
    <meta name="keywords" content="wallpaper, AI, generator, mobile, desktop, art">
    <meta name="author" content="Wallpaper Studio Pro">

    <title>Wallpaper Studio Pro - AI Wallpaper Generator</title>

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé®</text></svg>">

    <!-- Load Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Load Three.js for WebGL Animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-dark': '#121212',
                        'card-bg': '#1E1E1E',
                        'accent': '#E0E0E0',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out forwards',
                        'slide-out': 'slideOut 0.3s ease-in forwards',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        },
                        slideOut: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(100%)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="font-sans min-h-screen flex flex-col items-center justify-center p-4">
    <!-- WebGL Background -->
    <canvas id="webgl-canvas" aria-hidden="true"></canvas>

    <!-- App Header -->
    <header class="w-full max-w-md flex justify-between items-center py-4 mb-4 z-10">
        <!-- Aspect Ratio Switcher -->
        <button onclick="toggleAspectRatio()" id="aspect-btn"
            class="btn-haptic p-2 rounded-full hover:bg-white/10 transition flex items-center gap-2 backdrop-blur-md bg-white/5"
            title="Toggle Mobile/Desktop (Shortcut: A)" aria-label="Toggle aspect ratio">
            <i data-lucide="smartphone" class="text-white w-5 h-5"></i>
        </button>

        <h1 class="text-lg font-semibold tracking-wide">Wallpaper Studio Pro</h1>

        <!-- History Drawer Toggle -->
        <button onclick="toggleHistory()"
            class="btn-haptic p-2 rounded-full hover:bg-white/10 transition relative backdrop-blur-md bg-white/5"
            title="View History (Shortcut: H)" aria-label="Open history">
            <i data-lucide="history" class="text-white w-6 h-6"></i>
            <span id="favorites-badge"
                class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
        </button>
    </header>

    <!-- Main Split Interface -->
    <div class="w-full max-w-md relative z-10 perspective-container" id="tilt-wrapper">
        <div class="split-card-container flex flex-col relative shadow-2xl" id="main-card">

            <!-- Top Half: Genre -->
            <div class="flex-1 relative overflow-hidden group">
                <div class="absolute inset-0 carousel-overlay z-10 pointer-events-none"></div>
                <div id="genre-track" class="carousel-track h-full" role="region" aria-label="Genre selection"></div>

                <!-- Controls -->
                <button onclick="prevSlide('genre')"
                    class="btn-haptic absolute left-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-black/30 rounded-full backdrop-blur-sm hover:bg-white/20 transition opacity-0 group-hover:opacity-100"
                    aria-label="Previous genre">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-white"></i>
                </button>
                <button onclick="nextSlide('genre')"
                    class="btn-haptic absolute right-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-black/30 rounded-full backdrop-blur-sm hover:bg-white/20 transition opacity-0 group-hover:opacity-100"
                    aria-label="Next genre">
                    <i data-lucide="chevron-right" class="w-6 h-6 text-white"></i>
                </button>
                <div class="absolute bottom-6 w-full text-center z-20 pb-4">
                    <span id="genre-label" class="text-3xl font-bold text-white drop-shadow-lg"
                        style="text-shadow: 2px 2px 8px rgba(0,0,0,0.8)">Nature</span>
                </div>
            </div>

            <!-- Central Connector -->
            <div class="plus-connector" aria-hidden="true">
                <i data-lucide="plus" class="text-white w-6 h-6"></i>
            </div>

            <!-- Bottom Half: Style -->
            <div class="flex-1 relative overflow-hidden group">
                <div class="absolute inset-0 carousel-overlay z-10 pointer-events-none"></div>
                <div id="style-track" class="carousel-track h-full" role="region" aria-label="Style selection"></div>

                <!-- Controls -->
                <button onclick="prevSlide('style')"
                    class="btn-haptic absolute left-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-black/30 rounded-full backdrop-blur-sm hover:bg-white/20 transition opacity-0 group-hover:opacity-100"
                    aria-label="Previous style">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-white"></i>
                </button>
                <button onclick="nextSlide('style')"
                    class="btn-haptic absolute right-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-black/30 rounded-full backdrop-blur-sm hover:bg-white/20 transition opacity-0 group-hover:opacity-100"
                    aria-label="Next style">
                    <i data-lucide="chevron-right" class="w-6 h-6 text-white"></i>
                </button>
                <div class="absolute top-6 w-full text-center z-20 pt-4">
                    <span id="style-label" class="text-3xl font-bold text-white drop-shadow-lg"
                        style="text-shadow: 2px 2px 8px rgba(0,0,0,0.8)">Minimalist</span>
                </div>
            </div>

            <!-- Generation Overlay (inside main card) -->
            <div id="generation-overlay"
                class="absolute inset-0 bg-black/95 backdrop-blur-md z-30 hidden flex flex-col items-center justify-center">
                <!-- WebGL Animation Canvas -->
                <canvas id="webgl-generation-canvas" class="absolute inset-0 w-full h-full"></canvas>

                <!-- Loading Text Overlay -->
                <div id="generation-status"
                    class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-10">
                    <p class="text-white text-2xl font-bold pulse-glow mb-2">Designing...</p>
                    <p id="loading-text" class="text-gray-400 text-sm">Mixing Genre & Style</p>
                </div>

                <!-- Generated Image (hidden initially) -->
                <img id="generation-result-image" src="" alt="Generated Wallpaper"
                    class="absolute inset-0 w-full h-full object-cover hidden">

                <!-- Image Actions (shown after generation) -->
                <div id="generation-actions"
                    class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black via-black/80 to-transparent hidden z-20">
                    <div class="flex gap-2">
                        <button onclick="viewFullResult()"
                            class="flex-1 bg-white text-black font-bold py-3 px-4 rounded-full hover:bg-gray-200 transition flex items-center justify-center gap-2 text-sm">
                            <i data-lucide="maximize-2" class="w-4 h-4"></i>
                            <span>View Full</span>
                        </button>
                        <button onclick="downloadGenerated()"
                            class="flex-1 bg-white/10 backdrop-blur-md text-white font-bold py-3 px-4 rounded-full hover:bg-white/20 transition flex items-center justify-center gap-2 text-sm">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Download</span>
                        </button>
                        <button onclick="closeGenerationDisplay()"
                            class="bg-white/10 backdrop-blur-md text-white font-bold py-3 px-4 rounded-full hover:bg-white/20 transition flex items-center justify-center">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Area -->
    <div class="w-full max-w-md mt-6 flex flex-col items-center gap-4 z-10">

        <!-- Prompt Editor Toggle -->
        <div class="w-full">
            <div class="flex items-center justify-center gap-2 mb-2">
                <button onclick="togglePromptEditor()"
                    class="btn-haptic text-xs text-gray-400 hover:text-white transition flex items-center gap-1"
                    aria-label="Edit prompt">
                    <i data-lucide="edit-3" class="w-3 h-3"></i> Edit Prompt
                </button>
                <button onclick="copyPrompt()"
                    class="btn-haptic text-xs text-gray-400 hover:text-white transition flex items-center gap-1"
                    title="Copy prompt to clipboard" aria-label="Copy prompt">
                    <i data-lucide="copy" class="w-3 h-3"></i> Copy
                </button>
            </div>
            <textarea id="custom-prompt"
                class="hidden w-full bg-white/10 text-sm p-3 rounded-xl border border-white/10 focus:outline-none focus:border-white/50 h-24 resize-none mb-2 placeholder-gray-500 backdrop-blur-md"
                placeholder="Modify your prompt here..." aria-label="Custom prompt input"></textarea>
        </div>

        <!-- Advanced Controls Toggle -->
        <button onclick="toggleAdvancedControls()"
            class="btn-haptic text-xs text-gray-400 hover:text-white transition flex items-center gap-1"
            aria-label="Toggle advanced controls">
            <i data-lucide="chevron-down" class="w-3 h-3"></i> Advanced Settings
        </button>

        <!-- Advanced Controls Panel -->
        <div id="advanced-controls"
            class="advanced-controls w-full bg-white/5 rounded-xl p-4 space-y-3 backdrop-blur-md border border-white/10">
            <div>
                <label class="text-xs text-gray-400 block mb-1">Seed (for reproducibility)</label>
                <div class="flex gap-2">
                    <input type="number" id="seed-input" oninput="updateSeed(this.value)"
                        class="flex-1 bg-white/10 text-sm p-2 rounded-lg border border-white/10 focus:outline-none focus:border-white/50 backdrop-blur-sm"
                        placeholder="Random" aria-label="Seed value">
                    <button onclick="randomSeed()"
                        class="btn-haptic px-3 bg-white/10 rounded-lg hover:bg-white/20 transition backdrop-blur-sm"
                        aria-label="Generate random seed">
                        <i data-lucide="shuffle" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
            <div>
                <label class="text-xs text-gray-400 block mb-1">Quality Steps: <span id="steps-value">4</span></label>
                <input type="range" id="steps-input" min="1" max="8" value="4" oninput="updateSteps(this.value)"
                    class="w-full" aria-label="Quality steps">
            </div>
        </div>

        <!-- Generate Button -->
        <button id="generate-button"
            class="btn-haptic w-full bg-white text-black font-bold text-lg py-4 rounded-full shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-transform flex items-center justify-center gap-2"
            aria-label="Create wallpaper (Shortcut: Enter)">
            <i data-lucide="wand-2" class="w-5 h-5"></i>
            <span>Create Wallpaper</span>
        </button>

        <!-- Surprise Me Button - Enhanced Visibility -->
        <button onclick="randomize()"
            class="btn-haptic w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold text-base py-3 px-6 rounded-full shadow-lg hover:from-purple-700 hover:to-pink-700 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2 border border-purple-400/30"
            aria-label="Randomize selection (Shortcut: R)">
            <i data-lucide="dice-5" class="w-5 h-5"></i>
            <span>Surprise Me</span>
        </button>

        <!-- Keyboard Shortcuts Info -->
        <details class="text-xs text-gray-500 text-center">
            <summary class="cursor-pointer hover:text-gray-300">Keyboard Shortcuts</summary>
            <div class="mt-2 space-y-1">
                <p>‚Üê ‚Üí : Change Genre</p>
                <p>‚Üë ‚Üì : Change Style</p>
                <p>Enter : Generate</p>
                <p>R : Randomize</p>
                <p>H : History</p>
                <p>Esc : Close</p>
            </div>
        </details>
    </div>

    <!-- History Drawer -->
    <div id="history-drawer"
        class="fixed top-0 right-0 h-full w-full md:w-1/2 bg-[#0a0a0a]/95 backdrop-blur-2xl border-l border-white/10 z-50 transform translate-x-full transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1) shadow-2xl overflow-hidden flex flex-col"
        role="dialog" aria-label="History drawer">
        
        <!-- Header -->
        <div class="p-6 pb-2 border-b border-white/10 bg-black/20 z-10">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="font-bold text-2xl text-white tracking-tight">Collection</h2>
                    <p class="text-sm text-gray-400 mt-0.5">Your generated masterpieces</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="clearHistory()" class="btn-haptic p-3 text-red-400 hover:bg-red-500/10 rounded-xl transition"
                        title="Clear all history">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                    <button onclick="toggleHistory()" class="btn-haptic p-3 hover:bg-white/10 rounded-full transition"
                        title="Close history">
                        <i data-lucide="x" class="w-6 h-6 text-white"></i>
                    </button>
                </div>
            </div>

            <!-- NEW: Filter Tabs -->
            <div class="flex p-1 bg-white/5 rounded-xl border border-white/5 backdrop-blur-md">
                <button onclick="setHistoryFilter('all')" id="tab-all" 
                    class="flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 bg-white text-black shadow-lg">
                    <i data-lucide="grid" class="w-4 h-4"></i> All
                </button>
                <button onclick="setHistoryFilter('favorites')" id="tab-favorites" 
                    class="flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 text-gray-400 hover:text-white">
                    <i data-lucide="star" class="w-4 h-4"></i> Favorites
                </button>
            </div>
        </div>
        
        <!-- List Container -->
        <div id="history-list" class="flex-1 overflow-y-auto p-6 space-y-8 scroll-smooth">
            <p class="text-gray-500 text-center mt-20">No wallpapers yet.</p>
        </div>
    </div>

    <!-- Overlay for history -->
    <div id="history-overlay" onclick="toggleHistory()" class="fixed inset-0 bg-black/50 z-30 hidden backdrop-blur-sm"
        aria-hidden="true"></div>

    <!-- Result Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black/95 z-50 hidden flex flex-col" role="dialog"
        aria-label="Generated wallpaper">
        <div class="flex justify-between p-4 z-50">
            <!-- Lock Screen Preview Toggle -->
            <button onclick="toggleLockScreen()"
                class="btn-haptic p-2 bg-white/10 rounded-full hover:bg-white/20 text-white backdrop-blur-md"
                title="Preview Lock Screen" aria-label="Toggle lock screen preview">
                <i data-lucide="eye" class="w-6 h-6"></i>
            </button>

            <!-- Share Button -->
            <div class="relative">
                <button onclick="toggleShareMenu()"
                    class="btn-haptic p-2 bg-white/10 rounded-full hover:bg-white/20 text-white backdrop-blur-md"
                    aria-label="Share options">
                    <i data-lucide="share-2" class="w-6 h-6"></i>
                </button>
                <div id="share-menu" class="share-menu">
                    <button onclick="shareImage('download')" class="share-btn" aria-label="Download">
                        <i data-lucide="download" class="w-5 h-5"></i>
                    </button>
                    <button onclick="shareImage('copy')" class="share-btn" aria-label="Copy link">
                        <i data-lucide="link" class="w-5 h-5"></i>
                    </button>
                    <button onclick="shareImage('twitter')" class="share-btn" aria-label="Share on Twitter">
                        <i data-lucide="twitter" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <button onclick="closeResult()"
                class="btn-haptic p-2 bg-white/10 rounded-full hover:bg-white/20 backdrop-blur-md" aria-label="Close">
                <i data-lucide="x" class="w-6 h-6 text-white"></i>
            </button>
        </div>

        <div class="flex-1 flex items-center justify-center p-4 overflow-hidden relative">
            <div class="relative w-full h-full flex items-center justify-center">
                <img id="result-image" src="" alt="Generated Wallpaper"
                    class="max-h-full max-w-full rounded-2xl shadow-2xl object-contain">

                <!-- Lock Screen Overlay -->
                <div id="lock-screen-overlay"
                    class="absolute inset-0 pointer-events-none hidden flex flex-col items-center pt-20 text-white"
                    aria-hidden="true">
                    <div class="text-6xl font-thin tracking-tighter" id="lock-time">12:45</div>
                    <div class="text-lg font-medium mt-2" id="lock-date">Thursday, November 20</div>
                    <div class="mt-auto mb-12 text-xs tracking-widest opacity-60 animate-pulse">SWIPE UP TO UNLOCK</div>
                </div>
            </div>
        </div>

        <div class="p-6 flex flex-col gap-3 bg-gradient-to-t from-black to-transparent z-50">
            <p id="result-seed" class="text-center text-xs text-gray-400 hidden"></p>
            <button id="download-link" onclick="downloadFromModal()"
                class="btn-haptic w-full bg-white text-black font-bold py-4 rounded-full text-center hover:bg-gray-200 transition flex items-center justify-center gap-2">
                <i data-lucide="download" class="w-5 h-5"></i>
                Download Wallpaper
            </button>
            <p class="text-center text-xs text-gray-500">Generated by Flux-1 Schnell</p>
        </div>
    </div>

    <!-- Hidden Logic Inputs -->
    <input type="hidden" id="width" value="1080">
    <input type="hidden" id="height" value="1920">

    <!-- Load Main Application Script -->
    <script type="module" src="app.js"></script>
</body>

</html>